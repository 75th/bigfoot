(function(){!function(a){return a.bigfoot=function(b){var c,d,e,f;return c=void 0,d={actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,breakpoints:{},deleteOnUnhover:!1,hoverDelay:250,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:'<aside class="footnote-content bottom" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"> <div class="footnote-main-wrapper"> <div class="footnote-content-wrapper"> {{FOOTNOTECONTENT}} </div></div> <div class="bigfoot-tooltip"></div> </aside>',buttonMarkup:'<div class=\'footnote-container\'> <a href="#" class="footnote-button" id="{{SUP:data-footnote-backlink-ref}}" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote" data-footnote-content="{{FOOTNOTECONTENT}}"> <span class="footnote-circle" data-footnote-number="{{FOOTNOTENUM}}"></span> <span class="footnote-circle"></span> <span class="footnote-circle"></span> </a></div>'},f=a.extend(d,b),e=function(){var b,d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;for(w=null!=f.scope?""+f.scope+' a[href*="#"]':'a[href*="#"]',g=a(w).filter(function(){var b,c;return b=a(this),c=b.attr("rel"),("null"===c||null==c)&&(c=""),(""+b.attr("href")+c).match(/(fn|footnote|note)[:\-_\d]/gi)&&b.closest("[class*=footnote]:not(a):not(sup)").length<1}),B=[],z=[],u=[],p(g,z),a(z).each(function(){var b,c;return c=a(this).data("footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&"),f.useFootnoteOnlyOnce&&(c=""+c+":not(.footnote-processed)"),b=a(c).closest("li"),b.length>0?(B.push(b.first().addClass("footnote-processed")),u.push(this)):void 0}),d=a("[data-footnote-identifier]:last"),y=d.length<1?0:+d.data("footnote-identifier"),D=Q=0,R=B.length;R>=0?R>Q:Q>R;D=R>=0?++Q:--Q)switch(x=G(a(B[D]).html().trim(),a(u[D]).data("footnote-backlink-ref").replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;")),y+=1,v="",k=a(u[D]),null!=f.numberResetSelector?(b=k.closest(f.numberResetSelector),b.is(i)?A+=1:A=1,i=b):A=y,0!==x.indexOf("<")&&(x="<p>"+x+"</p>"),v=f.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,A).replace(/\{\{FOOTNOTEID\}\}/g,y).replace(/\{\{FOOTNOTECONTENT\}\}/g,x),v=J(v,"SUP",k),v=J(v,"FN",$relevantFootnote),h=a(v).insertBefore(k),j=$relevantFootnote.parent(),f.actionOriginalFN.toLowerCase()){case"hide":k.addClass("footnote-print-only"),$relevantFootnote.addClass("footnote-print-only"),s(j);break;case"delete":k.remove(),$relevantFootnote.remove(),s(j);break;default:k.addClass("footnote-print-only")}return p=function(b,c){var d,e,f,g;null==c&&(c=[]),e=void 0,d=void 0,f=void 0,g=void 0,b.each(function(){var b;return b=a(this),f="#"+b.attr("href").split("#")[1],e=b.closest("sup"),d=b.find("sup"),e.length>0?(g=(e.attr("id")||"")+(b.attr("id")||""),c.push(e.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):d.length>0?(g=(d.attr("id")||"")+(b.attr("id")||""),c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):(g=b.attr("id")||"",c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f})))})},s=function(a){return j=void 0,a.is(":empty")||0===a.children(":not(.footnote-print-only)").length?(j=a.parent(),"delete"===f.actionOriginalFN.toLowerCase()?a.remove():a.addClass("footnote-print-only"),s(j)):a.children(":not(.footnote-print-only)").length===a.children("hr:not(.footnote-print-only)").length?(j=a.parent(),"delete"===f.actionOriginalFN.toLowerCase()?a.remove():(a.children("hr").addClass("footnote-print-only"),a.addClass("footnote-print-only")),s(j)):void 0},G=function(a,b){var c;return b.indexOf(" ")>=0&&(b=b.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),c=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+b+"[^>]*>(.*?)<\\s*/\\s*a>","g"),a.replace(c,"").replace("[]","")},J=function(a,b,c){var d,e,f,g;for(e=new RegExp("\\{\\{"+b+":([^\\}]*)\\}\\}","g"),d=void 0,g=void 0,f=void 0,d=e.exec(a);d;)d[1]&&(g=c.attr(d[1])||"",a=a.replace("{{"+b+":"+d[1]+"}}",g)),d=e.exec(a);return a},n=function(b){var c,d,e;if(f.activateOnHover){if(c=a(b.target).closest(".footnote-button"),d='[data-footnote-identifier="'+c.attr("data-footnote-identifier")+'"]',c.hasClass("active"))return;c.addClass("hover-instantiated"),f.allowMultipleFN||(e=".footnote-content:not("+d+")",I(e)),r(".footnote-button"+d).addClass("hover-instantiated")}},M=function(){var b,c,d;d=a(event.target),b=d.closest(".footnote-button"),c=d.closest(".footnote-content"),b.length>0?(event.preventDefault(),q(b)):c.length<1&&a(".footnote-content").length>0&&I()},q=function(a){var b;a.blur(),b='data-footnote-identifier="'+a.attr("data-footnote-identifier")+'"',a.hasClass("changing")||(a.hasClass("active")?f.allowMultipleFN?I(".footnote-content["+b+"]"):I():(a.addClass("changing"),setTimeout(function(){return a.removeClass("changing")},f.popoverCreateDelay),r(".footnote-button["+b+"]"),a.addClass("click-instantiated"),f.allowMultipleFN||I(".footnote-content:not(["+b+"])")))},r=function(b){var c,d;return c=void 0,c="string"!=typeof b&&f.allowMultipleFN?b:"string"!=typeof b?b.first():f.allowMultipleFN?a(b).closest(".footnote-button"):a(b+":first").closest(".footnote-button"),d=a(),c.each(function(){var b,e,g,h;g=a(this),h=void 0;try{return h=f.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,g.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,g.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,g.attr("data-footnote-content")).replace(/\&gtsym\;/g,"&gt;").replace(/\&ltsym\;/g,"&lt;"),h=J(h,"BUTTON",g)}finally{b=a(h);try{f.activateCallback(b,g)}catch(i){}b.insertAfter(c),popoverStates[g.attr("data-footnote-identifier")]="init",b.attr("bigfoot-max-width",o(b.css("max-width"),b)),b.css("max-width",1e4),e=b.find(".footnote-content-wrapper"),b.attr("data-bigfoot-max-height",o(e.css("max-height"),e)),K(),g.addClass("active"),b.find(".footnote-content-wrapper").bindScrollHandler(),d=d.add(b)}}),setTimeout(function(){return d.addClass("active")},f.popoverCreateDelay),d},m=function(){var a,b;return a=document.createElement("div"),a.style.cssText="display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;",a.appendChild(document.createElement("M")),document.body.appendChild(a),b=a.offsetHeight,document.body.removeChild(a),b},o=function(a,b){return"none"===a?a=1e4:a.indexOf("rem")>=0?a=parseFloat(a)*m():a.indexOf("em")>=0?a=parseFloat(a)*parseFloat(b.css("font-size")):a.indexOf("px")>=0?(a=parseFloat(a),60>=a&&(a/=parseFloat(b.parent().css("width")))):a.indexOf("%")>=0&&(a=parseFloat(a)/100),a},a.fn.bindScrollHandler=function(){return f.preventPageScroll?(a(this).on("DOMMouseScroll mousewheel",function(b){var c,d,e,f,g,h,i,j;return d=a(this),i=d.scrollTop(),h=d[0].scrollHeight,f=parseInt(d.css("height")),c=d.closest(".footnote-content"),d.scrollTop()>0&&d.scrollTop()<10&&c.addClass("scrollable"),c.hasClass("scrollable")?(e="DOMMouseScroll"===b.type?-40*b.originalEvent.detail:b.originalEvent.wheelDelta,j=e>0,g=function(){return b.stopPropagation(),b.preventDefault(),b.returnValue=!1,!1},!j&&-e>h-f-i?(d.scrollTop(h),c.addClass("fully-scrolled"),g()):j&&e>i?(d.scrollTop(0),c.removeClass("fully-scrolled"),g()):c.removeClass("fully-scrolled")):void 0}),a(this)):a(this)},N=function(b){return f.deleteOnUnhover&&f.activateOnHover?setTimeout(function(){var c;return c=a(b.target).closest(".footnote-content, .footnote-button"),a(".footnote-button:hover, .footnote-content:hover").length<1?I():void 0},f.hoverDelay):void 0},t=function(a){return 27===a.keyCode?I():void 0},I=function(b,c){var d,e,g,h;return null==b&&(b=".footnote-content"),null==c&&(c=f.popoverDeleteDelay),d=a(),h=void 0,e=void 0,g=void 0,a(b).each(function(){return g=a(this),h=g.attr("data-footnote-identifier"),e=a('.footnote-button[data-footnote-identifier="'+h+'"]'),e.hasClass("changing")?void 0:(d=d.add(e),e.removeClass("active hover-instantiated click-instantiated").addClass("changing"),g.removeClass("active").addClass("disapearing"),setTimeout(function(){return g.remove(),delete popoverStates[h],e.removeClass("changing")},c))}),d},K=function(b){var c;f.positionContent&&(c=b?b.type:"resize",a(".footnote-content").each(function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s;return g=a(this),i=g.attr("data-footnote-identifier"),h='data-footnote-identifier="'+i+'"',d=g.find(".footnote-content-wrapper"),b=g.siblings(".footnote-button"),r=L(b),k=parseFloat(g.css("margin-top")),l=+g.attr("data-bigfoot-max-height"),s=2*k+g.outerHeight(),m=1e4,p=r.bottomRoom<s&&r.topRoom>r.bottomRoom,j=popoverStates[i],p?("top"!==j&&(popoverStates[i]="top",g.addClass("top").removeClass("bottom"),g.css("transform-origin",100*r.leftRelative+"% 100%")),m=r.topRoom-k-15):(("bottom"!==j||"init"===j)&&(popoverStates[i]="bottom",g.removeClass("top").addClass("bottom"),g.css("transform-origin",100*r.leftRelative+"% 0%")),m=r.bottomRoom-k-15),g.find(".footnote-content-wrapper").css({"max-height":Math.min(m,l)+"px"}),"resize"===c&&(o=parseFloat(g.attr("bigfoot-max-width")),e=g.find(".footnote-main-wrapper"),n=o,1>=o&&(q=function(){var b,c;return c=1e4,f.maxWidthRelativeTo&&(b=a(f.maxWidthRelativeTo),b.length>0&&(c=b.outerWidth())),Math.min(window.innerWidth,c)}(),n=q*o),n=Math.min(n,g.find(".footnote-content-wrapper").outerWidth()+1),e.css("max-width",n+"px"),g.css({left:-r.leftRelative*n+parseFloat(b.css("margin-left"))+b.outerWidth()/2+"px"}),F(g,r.leftRelative)),parseInt(g.outerHeight())<g.find(".footnote-content-wrapper")[0].scrollHeight?g.addClass("scrollable"):void 0}))},F=function(a,b){var c;null==b&&(b=.5),c=a.find(".bigfoot-tooltip"),c.length>0&&c.css("left",""+100*b+"%")},L=function(a){var b,c,d,e,f,g;return c=parseFloat(a.css("margin-left")),d=parseFloat(a.outerWidth())-c,b=parseFloat(a.outerHeight()),g=P(),f=a.offset().top-g.scrollY+b/2,e=a.offset().left-g.scrollX+d/2,{topRoom:f,bottomRoom:g.height-f,leftRoom:e,rightRoom:g.width-e,leftRelative:e/g.width,topRelative:f/g.height}},P=function(){return{width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY}},l=function(a,b,d,e,g){var h,i,j,k,l,m,n;return null==e&&(e=f.popoverDeleteDelay),null==g&&(g=!0),k=void 0,i=void 0,m=void 0,"string"==typeof a?(m="iphone"===a.toLowerCase()?"<320px":"ipad"===a.toLowerCase()?"<768px":a,i=">"===m.charAt(0)?"min":"<"===m.charAt(0)?"max":null,l=i?"("+i+"-width: "+m.substring(1)+")":m,k=window.matchMedia(l)):k=a,k.media&&"invalid"===k.media?{added:!1,mq:k,listener:null}:(n="min"===i,h="max"===i,b=b||E(g,e,n,function(a){return a.addClass("fixed-bottom")}),d=d||E(g,e,h,function(){}),j=function(a){a.matches?b(g,c):d(g,c)},k.addListener(j),j(k),f.breakpoints[a]={added:!0,mq:k,listener:j},f.breakpoints[a])},E=function(a,b,c,d){return function(a,e){var f;return f=void 0,a&&(f=e.close(),e.updateSetting("activateCallback",d)),setTimeout(function(){return e.updateSetting("positionContent",c),a?e.activate(f):void 0},b)}},H=function(a,b){var c,d,e,g;if(e=null,c=void 0,g=!1,"string"==typeof a)g=void 0!==f.breakpoints[a];else for(c in f.breakpoints)f.breakpoints.hasOwnProperty(c)&&f.breakpoints[c].mq===a&&(g=!0);return g&&(d=f.breakpoints[c||a],b?b({matches:!1}):d.listener({matches:!1}),d.mq.removeListener(d.listener),delete f.breakpoints[c||a]),g},O=function(a,b){var c,d;if(c=void 0,"string"==typeof a)c=f[a],f[a]=b;else{c={};for(d in a)a.hasOwnProperty(d)&&(c[d]=f[d],f[d]=a[d])}return c},C=function(a){return f[a]},a(document).ready(function(){return e(),a(document).on("mouseenter",".footnote-button",n),a(document).on("touchend click",M),a(document).on("mouseout",".hover-instantiated",N),a(document).on("keyup",t),a(window).on("scroll resize",K),a(document).on("gestureend",function(){return K()})}),c={removePopovers:I,close:I,createPopover:r,activate:r,repositionFeet:K,reposition:K,addBreakpoint:l,removeBreakpoint:H,getSetting:C,updateSetting:O}}}}(jQuery)}).call(this);